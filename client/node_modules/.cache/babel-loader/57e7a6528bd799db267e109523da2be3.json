{"ast":null,"code":"\"use strict\";\n/* --------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n * ------------------------------------------------------------------------------------------ */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Semaphore = void 0;\n\nconst ral_1 = require(\"./ral\");\n\nclass Semaphore {\n  constructor(capacity = 1) {\n    if (capacity <= 0) {\n      throw new Error('Capacity must be greater than 0');\n    }\n\n    this._capacity = capacity;\n    this._active = 0;\n    this._waiting = [];\n  }\n\n  lock(thunk) {\n    return new Promise((resolve, reject) => {\n      this._waiting.push({\n        thunk,\n        resolve,\n        reject\n      });\n\n      this.runNext();\n    });\n  }\n\n  get active() {\n    return this._active;\n  }\n\n  runNext() {\n    if (this._waiting.length === 0 || this._active === this._capacity) {\n      return;\n    }\n\n    ral_1.default().timer.setImmediate(() => this.doRunNext());\n  }\n\n  doRunNext() {\n    if (this._waiting.length === 0 || this._active === this._capacity) {\n      return;\n    }\n\n    const next = this._waiting.shift();\n\n    this._active++;\n\n    if (this._active > this._capacity) {\n      throw new Error(`To many thunks active`);\n    }\n\n    try {\n      const result = next.thunk();\n\n      if (result instanceof Promise) {\n        result.then(value => {\n          this._active--;\n          next.resolve(value);\n          this.runNext();\n        }, err => {\n          this._active--;\n          next.reject(err);\n          this.runNext();\n        });\n      } else {\n        this._active--;\n        next.resolve(result);\n        this.runNext();\n      }\n    } catch (err) {\n      this._active--;\n      next.reject(err);\n      this.runNext();\n    }\n  }\n\n}\n\nexports.Semaphore = Semaphore;","map":{"version":3,"names":["Object","defineProperty","exports","value","Semaphore","ral_1","require","constructor","capacity","Error","_capacity","_active","_waiting","lock","thunk","Promise","resolve","reject","push","runNext","active","length","default","timer","setImmediate","doRunNext","next","shift","result","then","err"],"sources":["/Users/Ellie/Desktop/projects/book-search-engine/client/node_modules/vscode-jsonrpc/lib/common/semaphore.js"],"sourcesContent":["\"use strict\";\n/* --------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n * ------------------------------------------------------------------------------------------ */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Semaphore = void 0;\nconst ral_1 = require(\"./ral\");\nclass Semaphore {\n    constructor(capacity = 1) {\n        if (capacity <= 0) {\n            throw new Error('Capacity must be greater than 0');\n        }\n        this._capacity = capacity;\n        this._active = 0;\n        this._waiting = [];\n    }\n    lock(thunk) {\n        return new Promise((resolve, reject) => {\n            this._waiting.push({ thunk, resolve, reject });\n            this.runNext();\n        });\n    }\n    get active() {\n        return this._active;\n    }\n    runNext() {\n        if (this._waiting.length === 0 || this._active === this._capacity) {\n            return;\n        }\n        ral_1.default().timer.setImmediate(() => this.doRunNext());\n    }\n    doRunNext() {\n        if (this._waiting.length === 0 || this._active === this._capacity) {\n            return;\n        }\n        const next = this._waiting.shift();\n        this._active++;\n        if (this._active > this._capacity) {\n            throw new Error(`To many thunks active`);\n        }\n        try {\n            const result = next.thunk();\n            if (result instanceof Promise) {\n                result.then((value) => {\n                    this._active--;\n                    next.resolve(value);\n                    this.runNext();\n                }, (err) => {\n                    this._active--;\n                    next.reject(err);\n                    this.runNext();\n                });\n            }\n            else {\n                this._active--;\n                next.resolve(result);\n                this.runNext();\n            }\n        }\n        catch (err) {\n            this._active--;\n            next.reject(err);\n            this.runNext();\n        }\n    }\n}\nexports.Semaphore = Semaphore;\n//# sourceMappingURL=semaphore.js.map"],"mappings":"AAAA;AACA;AACA;AACA;AACA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,SAAR,GAAoB,KAAK,CAAzB;;AACA,MAAMC,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AACA,MAAMF,SAAN,CAAgB;EACZG,WAAW,CAACC,QAAQ,GAAG,CAAZ,EAAe;IACtB,IAAIA,QAAQ,IAAI,CAAhB,EAAmB;MACf,MAAM,IAAIC,KAAJ,CAAU,iCAAV,CAAN;IACH;;IACD,KAAKC,SAAL,GAAiBF,QAAjB;IACA,KAAKG,OAAL,GAAe,CAAf;IACA,KAAKC,QAAL,GAAgB,EAAhB;EACH;;EACDC,IAAI,CAACC,KAAD,EAAQ;IACR,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;MACpC,KAAKL,QAAL,CAAcM,IAAd,CAAmB;QAAEJ,KAAF;QAASE,OAAT;QAAkBC;MAAlB,CAAnB;;MACA,KAAKE,OAAL;IACH,CAHM,CAAP;EAIH;;EACS,IAANC,MAAM,GAAG;IACT,OAAO,KAAKT,OAAZ;EACH;;EACDQ,OAAO,GAAG;IACN,IAAI,KAAKP,QAAL,CAAcS,MAAd,KAAyB,CAAzB,IAA8B,KAAKV,OAAL,KAAiB,KAAKD,SAAxD,EAAmE;MAC/D;IACH;;IACDL,KAAK,CAACiB,OAAN,GAAgBC,KAAhB,CAAsBC,YAAtB,CAAmC,MAAM,KAAKC,SAAL,EAAzC;EACH;;EACDA,SAAS,GAAG;IACR,IAAI,KAAKb,QAAL,CAAcS,MAAd,KAAyB,CAAzB,IAA8B,KAAKV,OAAL,KAAiB,KAAKD,SAAxD,EAAmE;MAC/D;IACH;;IACD,MAAMgB,IAAI,GAAG,KAAKd,QAAL,CAAce,KAAd,EAAb;;IACA,KAAKhB,OAAL;;IACA,IAAI,KAAKA,OAAL,GAAe,KAAKD,SAAxB,EAAmC;MAC/B,MAAM,IAAID,KAAJ,CAAW,uBAAX,CAAN;IACH;;IACD,IAAI;MACA,MAAMmB,MAAM,GAAGF,IAAI,CAACZ,KAAL,EAAf;;MACA,IAAIc,MAAM,YAAYb,OAAtB,EAA+B;QAC3Ba,MAAM,CAACC,IAAP,CAAa1B,KAAD,IAAW;UACnB,KAAKQ,OAAL;UACAe,IAAI,CAACV,OAAL,CAAab,KAAb;UACA,KAAKgB,OAAL;QACH,CAJD,EAIIW,GAAD,IAAS;UACR,KAAKnB,OAAL;UACAe,IAAI,CAACT,MAAL,CAAYa,GAAZ;UACA,KAAKX,OAAL;QACH,CARD;MASH,CAVD,MAWK;QACD,KAAKR,OAAL;QACAe,IAAI,CAACV,OAAL,CAAaY,MAAb;QACA,KAAKT,OAAL;MACH;IACJ,CAlBD,CAmBA,OAAOW,GAAP,EAAY;MACR,KAAKnB,OAAL;MACAe,IAAI,CAACT,MAAL,CAAYa,GAAZ;MACA,KAAKX,OAAL;IACH;EACJ;;AAzDW;;AA2DhBjB,OAAO,CAACE,SAAR,GAAoBA,SAApB"},"metadata":{},"sourceType":"script"}