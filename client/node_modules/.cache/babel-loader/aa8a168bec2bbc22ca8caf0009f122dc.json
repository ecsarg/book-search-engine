{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PossibleTypeExtensions = void 0;\n\nconst graphql_1 = require(\"graphql\");\n\nconst utils_1 = require(\"../../utils\");\n\nfunction PossibleTypeExtensions(context) {\n  const schema = context.getSchema();\n  const definedTypes = Object.create(null);\n\n  for (const def of context.getDocument().definitions) {\n    if (graphql_1.isTypeDefinitionNode(def)) {\n      definedTypes[def.name.value] = def;\n    }\n  }\n\n  const checkExtension = node => {\n    const typeName = node.name.value;\n    const defNode = definedTypes[typeName];\n    const existingType = schema && schema.getType(typeName);\n    const serviceName = node.serviceName;\n    if (!serviceName) return;\n\n    if (defNode) {\n      const expectedKind = utils_1.defKindToExtKind[defNode.kind];\n      const baseKind = defNode.kind;\n\n      if (expectedKind !== node.kind) {\n        context.reportError(utils_1.errorWithCode('EXTENSION_OF_WRONG_KIND', utils_1.logServiceAndType(serviceName, typeName) + `\\`${typeName}\\` was originally defined as a ${baseKind} and can only be extended by a ${expectedKind}. ${serviceName} defines ${typeName} as a ${node.kind}`, node));\n      }\n    } else if (existingType) {\n      const expectedKind = typeToExtKind(existingType);\n      const baseKind = typeToKind(existingType);\n\n      if (expectedKind !== node.kind) {\n        context.reportError(utils_1.errorWithCode('EXTENSION_OF_WRONG_KIND', utils_1.logServiceAndType(serviceName, typeName) + `\\`${typeName}\\` was originally defined as a ${baseKind} and can only be extended by a ${expectedKind}. ${serviceName} defines ${typeName} as a ${node.kind}`, node));\n      }\n    } else {\n      context.reportError(utils_1.errorWithCode('EXTENSION_WITH_NO_BASE', utils_1.logServiceAndType(serviceName, typeName) + `\\`${typeName}\\` is an extension type, but \\`${typeName}\\` is not defined in any service`, node));\n    }\n  };\n\n  return {\n    ObjectTypeExtension: checkExtension,\n    InterfaceTypeExtension: checkExtension\n  };\n}\n\nexports.PossibleTypeExtensions = PossibleTypeExtensions;\n\nfunction typeToExtKind(type) {\n  if (graphql_1.isScalarType(type)) {\n    return graphql_1.Kind.SCALAR_TYPE_EXTENSION;\n  } else if (graphql_1.isObjectType(type)) {\n    return graphql_1.Kind.OBJECT_TYPE_EXTENSION;\n  } else if (graphql_1.isInterfaceType(type)) {\n    return graphql_1.Kind.INTERFACE_TYPE_EXTENSION;\n  } else if (graphql_1.isUnionType(type)) {\n    return graphql_1.Kind.UNION_TYPE_EXTENSION;\n  } else if (graphql_1.isEnumType(type)) {\n    return graphql_1.Kind.ENUM_TYPE_EXTENSION;\n  } else if (graphql_1.isInputObjectType(type)) {\n    return graphql_1.Kind.INPUT_OBJECT_TYPE_EXTENSION;\n  }\n\n  return null;\n}\n\nfunction typeToKind(type) {\n  if (graphql_1.isScalarType(type)) {\n    return graphql_1.Kind.SCALAR_TYPE_DEFINITION;\n  } else if (graphql_1.isObjectType(type)) {\n    return graphql_1.Kind.OBJECT_TYPE_DEFINITION;\n  } else if (graphql_1.isInterfaceType(type)) {\n    return graphql_1.Kind.INTERFACE_TYPE_DEFINITION;\n  } else if (graphql_1.isUnionType(type)) {\n    return graphql_1.Kind.UNION_TYPE_DEFINITION;\n  } else if (graphql_1.isEnumType(type)) {\n    return graphql_1.Kind.ENUM_TYPE_DEFINITION;\n  } else if (graphql_1.isInputObjectType(type)) {\n    return graphql_1.Kind.INPUT_OBJECT_TYPE_DEFINITION;\n  }\n\n  return null;\n}","map":{"version":3,"sources":["../../../../src/composition/validate/sdl/possibleTypeExtensions.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PossibleTypeExtensions = void 0;\nconst graphql_1 = require(\"graphql\");\nconst utils_1 = require(\"../../utils\");\nfunction PossibleTypeExtensions(context) {\n    const schema = context.getSchema();\n    const definedTypes = Object.create(null);\n    for (const def of context.getDocument().definitions) {\n        if (graphql_1.isTypeDefinitionNode(def)) {\n            definedTypes[def.name.value] = def;\n        }\n    }\n    const checkExtension = (node) => {\n        const typeName = node.name.value;\n        const defNode = definedTypes[typeName];\n        const existingType = schema && schema.getType(typeName);\n        const serviceName = node.serviceName;\n        if (!serviceName)\n            return;\n        if (defNode) {\n            const expectedKind = utils_1.defKindToExtKind[defNode.kind];\n            const baseKind = defNode.kind;\n            if (expectedKind !== node.kind) {\n                context.reportError(utils_1.errorWithCode('EXTENSION_OF_WRONG_KIND', utils_1.logServiceAndType(serviceName, typeName) +\n                    `\\`${typeName}\\` was originally defined as a ${baseKind} and can only be extended by a ${expectedKind}. ${serviceName} defines ${typeName} as a ${node.kind}`, node));\n            }\n        }\n        else if (existingType) {\n            const expectedKind = typeToExtKind(existingType);\n            const baseKind = typeToKind(existingType);\n            if (expectedKind !== node.kind) {\n                context.reportError(utils_1.errorWithCode('EXTENSION_OF_WRONG_KIND', utils_1.logServiceAndType(serviceName, typeName) +\n                    `\\`${typeName}\\` was originally defined as a ${baseKind} and can only be extended by a ${expectedKind}. ${serviceName} defines ${typeName} as a ${node.kind}`, node));\n            }\n        }\n        else {\n            context.reportError(utils_1.errorWithCode('EXTENSION_WITH_NO_BASE', utils_1.logServiceAndType(serviceName, typeName) +\n                `\\`${typeName}\\` is an extension type, but \\`${typeName}\\` is not defined in any service`, node));\n        }\n    };\n    return {\n        ObjectTypeExtension: checkExtension,\n        InterfaceTypeExtension: checkExtension,\n    };\n}\nexports.PossibleTypeExtensions = PossibleTypeExtensions;\nfunction typeToExtKind(type) {\n    if (graphql_1.isScalarType(type)) {\n        return graphql_1.Kind.SCALAR_TYPE_EXTENSION;\n    }\n    else if (graphql_1.isObjectType(type)) {\n        return graphql_1.Kind.OBJECT_TYPE_EXTENSION;\n    }\n    else if (graphql_1.isInterfaceType(type)) {\n        return graphql_1.Kind.INTERFACE_TYPE_EXTENSION;\n    }\n    else if (graphql_1.isUnionType(type)) {\n        return graphql_1.Kind.UNION_TYPE_EXTENSION;\n    }\n    else if (graphql_1.isEnumType(type)) {\n        return graphql_1.Kind.ENUM_TYPE_EXTENSION;\n    }\n    else if (graphql_1.isInputObjectType(type)) {\n        return graphql_1.Kind.INPUT_OBJECT_TYPE_EXTENSION;\n    }\n    return null;\n}\nfunction typeToKind(type) {\n    if (graphql_1.isScalarType(type)) {\n        return graphql_1.Kind.SCALAR_TYPE_DEFINITION;\n    }\n    else if (graphql_1.isObjectType(type)) {\n        return graphql_1.Kind.OBJECT_TYPE_DEFINITION;\n    }\n    else if (graphql_1.isInterfaceType(type)) {\n        return graphql_1.Kind.INTERFACE_TYPE_DEFINITION;\n    }\n    else if (graphql_1.isUnionType(type)) {\n        return graphql_1.Kind.UNION_TYPE_DEFINITION;\n    }\n    else if (graphql_1.isEnumType(type)) {\n        return graphql_1.Kind.ENUM_TYPE_DEFINITION;\n    }\n    else if (graphql_1.isInputObjectType(type)) {\n        return graphql_1.Kind.INPUT_OBJECT_TYPE_DEFINITION;\n    }\n    return null;\n}\n//# sourceMappingURL=possibleTypeExtensions.js.map"]},"metadata":{},"sourceType":"script"}